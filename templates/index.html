<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Titanic Survival Prediction System - Machine Learning Application">
    <meta name="author" content="[Your Name]">
    <title>Titanic Survival Prediction System</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='0.9em' font-size='90'>üö¢</text></svg>">
</head>
<body>
    <!-- Background Animation -->
    <div class="ocean">
        <div class="wave"></div>
        <div class="wave"></div>
    </div>

    <!-- Main Container -->
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="logo">üö¢</div>
            <h1 class="title">Titanic Survival Prediction System</h1>
            <p class="subtitle">Machine Learning-Based Passenger Survival Prediction</p>
        </header>

        <!-- Model Information Card -->
        <div class="info-card">
            <h3>üìä Model Information</h3>
            <div class="model-stats" id="modelStats">
                <div class="stat-item">
                    <span class="stat-label">Algorithm:</span>
                    <span class="stat-value">Random Forest Classifier</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Features:</span>
                    <span class="stat-value">5 Features</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Accuracy:</span>
                    <span class="stat-value" id="modelAccuracy">Loading...</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Status:</span>
                    <span class="stat-value status-ready" id="modelStatus">Ready</span>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="content">
            <!-- Input Form -->
            <div class="card form-card">
                <h2 class="card-title">Enter Passenger Information</h2>
                <form id="predictionForm">
                    <!-- Passenger Class -->
                    <div class="form-group">
                        <label for="pclass" class="form-label">
                            <span class="label-icon">üé´</span>
                            Passenger Class
                        </label>
                        <select id="pclass" name="pclass" class="form-input" required>
                            <option value="">Select Class</option>
                            <option value="1">1st Class (Upper)</option>
                            <option value="2">2nd Class (Middle)</option>
                            <option value="3">3rd Class (Lower)</option>
                        </select>
                        <small class="form-help">Ticket class: 1st = Upper, 2nd = Middle, 3rd = Lower</small>
                    </div>

                    <!-- Sex -->
                    <div class="form-group">
                        <label for="sex" class="form-label">
                            <span class="label-icon">üë§</span>
                            Sex
                        </label>
                        <div class="radio-group">
                            <label class="radio-label">
                                <input type="radio" name="sex" value="male" required>
                                <span class="radio-custom"></span>
                                Male
                            </label>
                            <label class="radio-label">
                                <input type="radio" name="sex" value="female" required>
                                <span class="radio-custom"></span>
                                Female
                            </label>
                        </div>
                    </div>

                    <!-- Age -->
                    <div class="form-group">
                        <label for="age" class="form-label">
                            <span class="label-icon">üìÖ</span>
                            Age (years)
                        </label>
                        <input 
                            type="number" 
                            id="age" 
                            name="age" 
                            class="form-input" 
                            min="0" 
                            max="120" 
                            step="0.1" 
                            placeholder="Enter age (e.g., 25)"
                            required
                        >
                        <small class="form-help">Age in years (0-120)</small>
                    </div>

                    <!-- Fare -->
                    <div class="form-group">
                        <label for="fare" class="form-label">
                            <span class="label-icon">üí∞</span>
                            Fare (¬£)
                        </label>
                        <input 
                            type="number" 
                            id="fare" 
                            name="fare" 
                            class="form-input" 
                            min="0" 
                            step="0.01" 
                            placeholder="Enter ticket fare (e.g., 50.00)"
                            required
                        >
                        <small class="form-help">Ticket price in British Pounds</small>
                    </div>

                    <!-- Embarked -->
                    <div class="form-group">
                        <label for="embarked" class="form-label">
                            <span class="label-icon">‚öì</span>
                            Port of Embarkation
                        </label>
                        <select id="embarked" name="embarked" class="form-input" required>
                            <option value="">Select Port</option>
                            <option value="C">Cherbourg (C)</option>
                            <option value="Q">Queenstown (Q)</option>
                            <option value="S">Southampton (S)</option>
                        </select>
                        <small class="form-help">Where the passenger boarded the Titanic</small>
                    </div>

                    <!-- Submit Button -->
                    <button type="submit" class="btn btn-primary" id="predictBtn">
                        <span class="btn-text">Predict Survival</span>
                        <span class="btn-loader" style="display: none;">
                            <span class="spinner"></span>
                            Processing...
                        </span>
                    </button>

                    <!-- Reset Button -->
                    <button type="reset" class="btn btn-secondary">
                        Reset Form
                    </button>
                </form>
            </div>

            <!-- Results Card -->
            <div class="card result-card" id="resultCard" style="display: none;">
                <h2 class="card-title">Prediction Result</h2>
                
                <!-- Result Display -->
                <div class="result-display" id="resultDisplay">
                    <div class="result-icon" id="resultIcon">
                        <!-- Icon will be inserted here -->
                    </div>
                    <h3 class="result-text" id="resultText">
                        <!-- Result text will be inserted here -->
                    </h3>
                    <div class="confidence-bar">
                        <div class="confidence-label">Confidence Level</div>
                        <div class="confidence-progress">
                            <div class="confidence-fill" id="confidenceFill"></div>
                        </div>
                        <div class="confidence-value" id="confidenceValue">0%</div>
                    </div>
                </div>

                <!-- Probability Details -->
                <div class="probability-details" id="probabilityDetails">
                    <div class="probability-item">
                        <div class="probability-label">
                            <span class="probability-icon">‚úì</span>
                            Survival Probability
                        </div>
                        <div class="probability-value" id="survivalProb">0%</div>
                    </div>
                    <div class="probability-item">
                        <div class="probability-label">
                            <span class="probability-icon">‚úó</span>
                            Death Probability
                        </div>
                        <div class="probability-value" id="deathProb">0%</div>
                    </div>
                </div>

                <!-- Input Summary -->
                <div class="input-summary" id="inputSummary">
                    <h4>Input Details</h4>
                    <div class="summary-grid" id="summaryGrid">
                        <!-- Summary will be inserted here -->
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="result-actions">
                    <button class="btn btn-secondary" onclick="resetPrediction()">
                        Make Another Prediction
                    </button>
                </div>
            </div>

            <!-- Error Card -->
            <div class="card error-card" id="errorCard" style="display: none;">
                <div class="error-icon">‚ö†Ô∏è</div>
                <h3 class="error-title">Prediction Error</h3>
                <p class="error-message" id="errorMessage"></p>
                <button class="btn btn-secondary" onclick="hideError()">
                    Try Again
                </button>
            </div>
        </div>

        <!-- Footer -->
        <footer class="footer">
            <div class="footer-content">
                <p>
                    <strong>Titanic Survival Prediction System</strong><br>
                    Machine Learning Project - COS331 Artificial Intelligence<br>
                    Covenant University | 2025/2026 Session
                </p>
                <p class="footer-meta">
                    Algorithm: Random Forest | Model Persistence: Joblib<br>
                    Developed by: <strong>[Your Name]</strong> | Matric No: <strong>[Your Matric Number]</strong>
                </p>
            </div>
        </footer>
    </div>

    <!-- JavaScript -->
    <script>
        // Global variables
        let modelInfo = null;

        // Load model information on page load
        window.addEventListener('DOMContentLoaded', async () => {
            await loadModelInfo();
        });

        // Load model information from server
        async function loadModelInfo() {
            try {
                const response = await fetch('/model-info');
                const data = await response.json();

                if (data.success) {
                    modelInfo = data.model_info;
                    updateModelDisplay();
                } else {
                    document.getElementById('modelAccuracy').textContent = 'Error';
                    document.getElementById('modelStatus').textContent = 'Error';
                    document.getElementById('modelStatus').className = 'stat-value status-error';
                }
            } catch (error) {
                console.error('Error loading model info:', error);
                document.getElementById('modelAccuracy').textContent = 'N/A';
                document.getElementById('modelStatus').textContent = 'Unavailable';
                document.getElementById('modelStatus').className = 'stat-value status-error';
            }
        }

        // Update model information display
        function updateModelDisplay() {
            if (modelInfo) {
                const accuracy = (modelInfo.test_accuracy * 100).toFixed(2);
                document.getElementById('modelAccuracy').textContent = `${accuracy}%`;
            }
        }

        // Handle form submission
        document.getElementById('predictionForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            await makePrediction();
        });

        // Make prediction
        async function makePrediction() {
            // Show loading state
            const predictBtn = document.getElementById('predictBtn');
            const btnText = predictBtn.querySelector('.btn-text');
            const btnLoader = predictBtn.querySelector('.btn-loader');
            
            predictBtn.disabled = true;
            btnText.style.display = 'none';
            btnLoader.style.display = 'flex';

            // Hide previous results/errors
            hideResult();
            hideError();

            try {
                // Get form data
                const formData = {
                    pclass: document.getElementById('pclass').value,
                    sex: document.querySelector('input[name="sex"]:checked').value,
                    age: document.getElementById('age').value,
                    fare: document.getElementById('fare').value,
                    embarked: document.getElementById('embarked').value
                };

                // Send prediction request
                const response = await fetch('/predict', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(formData)
                });

                const data = await response.json();

                if (data.success) {
                    displayResult(data.result);
                } else {
                    displayError(data.error || 'An error occurred during prediction');
                }
            } catch (error) {
                console.error('Prediction error:', error);
                displayError('Failed to connect to the server. Please try again.');
            } finally {
                // Reset button state
                predictBtn.disabled = false;
                btnText.style.display = 'inline';
                btnLoader.style.display = 'none';
            }
        }

        // Display prediction result
        function displayResult(result) {
            const resultCard = document.getElementById('resultCard');
            const resultIcon = document.getElementById('resultIcon');
            const resultText = document.getElementById('resultText');
            const confidenceFill = document.getElementById('confidenceFill');
            const confidenceValue = document.getElementById('confidenceValue');
            const survivalProb = document.getElementById('survivalProb');
            const deathProb = document.getElementById('deathProb');
            const summaryGrid = document.getElementById('summaryGrid');

            // Set result icon and text
            if (result.prediction === 1) {
                resultIcon.innerHTML = '<div class="icon-survived">‚úì</div>';
                resultText.innerHTML = '<span class="result-survived">SURVIVED</span>';
                resultText.className = 'result-text survived';
            } else {
                resultIcon.innerHTML = '<div class="icon-not-survived">‚úó</div>';
                resultText.innerHTML = '<span class="result-not-survived">DID NOT SURVIVE</span>';
                resultText.className = 'result-text not-survived';
            }

            // Set confidence
            const confidence = (result.confidence * 100).toFixed(2);
            confidenceFill.style.width = `${confidence}%`;
            confidenceValue.textContent = `${confidence}%`;

            // Set confidence color
            if (confidence >= 80) {
                confidenceFill.style.backgroundColor = '#4ECDC4';
            } else if (confidence >= 60) {
                confidenceFill.style.backgroundColor = '#FFE66D';
            } else {
                confidenceFill.style.backgroundColor = '#FF6B6B';
            }

            // Set probabilities
            survivalProb.textContent = `${(result.survival_probability * 100).toFixed(2)}%`;
            deathProb.textContent = `${(result.death_probability * 100).toFixed(2)}%`;

            // Create input summary
            const input = result.input;
            summaryGrid.innerHTML = `
                <div class="summary-item">
                    <span class="summary-label">Passenger Class:</span>
                    <span class="summary-value">${input.pclass === 1 ? '1st' : input.pclass === 2 ? '2nd' : '3rd'} Class</span>
                </div>
                <div class="summary-item">
                    <span class="summary-label">Sex:</span>
                    <span class="summary-value">${input.sex}</span>
                </div>
                <div class="summary-item">
                    <span class="summary-label">Age:</span>
                    <span class="summary-value">${input.age} years</span>
                </div>
                <div class="summary-item">
                    <span class="summary-label">Fare:</span>
                    <span class="summary-value">¬£${parseFloat(input.fare).toFixed(2)}</span>
                </div>
                <div class="summary-item">
                    <span class="summary-label">Embarked:</span>
                    <span class="summary-value">${getPortName(input.embarked)}</span>
                </div>
            `;

            // Show result card with animation
            resultCard.style.display = 'block';
            setTimeout(() => {
                resultCard.classList.add('show');
            }, 10);

            // Scroll to result
            resultCard.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        // Display error
        function displayError(message) {
            const errorCard = document.getElementById('errorCard');
            const errorMessage = document.getElementById('errorMessage');

            errorMessage.textContent = message;
            errorCard.style.display = 'block';
            setTimeout(() => {
                errorCard.classList.add('show');
            }, 10);

            // Scroll to error
            errorCard.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        // Hide result
        function hideResult() {
            const resultCard = document.getElementById('resultCard');
            resultCard.classList.remove('show');
            setTimeout(() => {
                resultCard.style.display = 'none';
            }, 300);
        }

        // Hide error
        function hideError() {
            const errorCard = document.getElementById('errorCard');
            errorCard.classList.remove('show');
            setTimeout(() => {
                errorCard.style.display = 'none';
            }, 300);
        }

        // Reset prediction
        function resetPrediction() {
            hideResult();
            document.getElementById('predictionForm').scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        // Helper function to get port name
        function getPortName(code) {
            const ports = {
                'C': 'Cherbourg',
                'Q': 'Queenstown',
                'S': 'Southampton'
            };
            return ports[code] || code;
        }

        // Form reset handler
        document.getElementById('predictionForm').addEventListener('reset', () => {
            hideResult();
            hideError();
        });
    </script>
</body>
</html>
